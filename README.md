# Отчет по лабораторной работе

## Кластеризация и масштабирование веб-систем

## Обзор проекта

В рамках работы было реализовано масштабируемое **Fullstack-приложение** (Flask + Redis + Vite/React). Основной акцент сделан на обеспечении **высокой доступности бэкенд-слоя** и анализе поведения **распределенной системы** в среде **Docker Swarm**.

---

## 1. Архитектура кластера

Для выполнения условий задачи была развернута инфраструктура со следующими параметрами:

- **Оркестратор:** Docker Swarm (инициализирован через `docker swarm init`)
- **App Server:** 4 реплики Flask-приложения, работающих под управлением Gunicorn
- **Database:** 2 реплики Redis `7-alpine`
- **Network:** Изолированная сеть типа `overlay` (`counter-net`) для обеспечения внутреннего DNS-резолвинга между сервисами

---

## 2. Нагрузочное тестирование

Тестирование проводилось в среде **Windows 11** с использованием **PowerShell**. Был применен метод _последовательной подачи нагрузки_ для определения базовой стабильности системы.

### Сценарий теста

```powershell
Measure-Command {
  1..100 | ForEach-Object {
    Invoke-WebRequest -Uri "http://localhost" -Method Get
  }
}
```

### Результаты

| Параметр                             | Значение  |
| ------------------------------------ | --------- |
| Общее время обработки (100 запросов) | 27.55 сек |
| Среднее время отклика (Latency)      | 275 мс    |
| Процент успешных запросов            | 100%      |

### Анализ потенциала

Несмотря на последовательный характер теста, наличие **4-х инстансов приложения** позволяет системе мгновенно переходить к обработке следующего запроса другим свободным воркером.

В условиях **реальной параллельной нагрузки** (_high concurrency_) данный кластер способен обрабатывать **примерно в 4 раза больше трафика**, чем одиночный контейнер, до момента возникновения блокировок на уровне базы данных.

---

## 3. Анализ репликации базы данных

При масштабировании сервиса Redis до **двух реплик** без использования кластерного режима (_Redis Cluster_) была выявлена проблема консистентности данных.

### Проблема

Балансировщик Docker Swarm распределяет запросы между двумя независимыми узлами Redis. Поскольку данные между ними **не синхронизируются**, значение счетчика становится **нелинейным** — пользователь видит разные состояния при каждом обновлении страницы.

### Решение

В промышленной эксплуатации рекомендуется использовать **Redis Sentinel** для реализации схемы **Master-Slave**.

Для данного учебного проекта наиболее стабильным решением является:

- использование **одной реплики Redis**;
- сохранение **множественных реплик приложения**.

---

## 4. Переход к оркестрации в Kubernetes (k3s)

В ходе исследования был подготовлен манифест `deployment.yaml`. Были выявлены ключевые преимущества перехода с Docker Swarm на Kubernetes:

- **Управление состоянием:** использование `StatefulSet` для Redis гарантирует стабильные идентификаторы и хранилища для узлов БД;
- **Service Discovery:** абстракция `Service` обеспечивает более надежный балансировщик и внутренний DNS, устраняя ошибки вида `Name or service not known`;
- **Liveness / Readiness Probes:** автоматическое исключение зависших контейнеров из балансировки нагрузки.

---

## 5. Инструкция по запуску

### Сборка Docker-образа

```bash
docker build -t counter-app:latest .
```

### Инициализация Docker Swarm

```bash
docker swarm init
```

### Развертывание стека

```bash
docker stack deploy -c docker-compose.yml counter_stack
```

### Мониторинг сервисов

```bash
docker service ls
```

---

## Выводы

В ходе лабораторной работы была исследована модель масштабирования веб-приложения в контейнеризованной среде. Практика показала, что:

- горизонтальное масштабирование приложения эффективно увеличивает пропускную способность;
- масштабирование состояния без репликации приводит к потере консистентности;
- Kubernetes предоставляет более зрелые механизмы управления состоянием и отказоустойчивости по сравнению с Docker Swarm.

Полученные результаты подтверждают целесообразность применения Kubernetes для промышленной эксплуатации масштабируемых веб-систем.
